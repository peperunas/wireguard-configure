# wireguard-configure

`wireguard-configure` is a command-line utility to help manage wireguard configurations. It assumes a basic setup with one node acting as a, "Router," and several clients which connect and route traffic between the central router node. It allows you to generate and dump wireguard configurations, and bash scripts which also configure interfaces and routes.

You must have the commandline tool `wg` accessible through your path. This is used to automatically generate private/public wireguard keys.

Configurations are stored in yaml, and can be modified from the command line, or directly in the yaml file.

```
wireguard-configure 0.2.1
Alex Eubanks <endeavor@rainbowsandpwnies.com>, Giulio De Pasquale <depasquale+github@giugl.io>

USAGE:
    wireguard-configure <SUBCOMMAND>

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

SUBCOMMANDS:
    add-client          Add a client to the configuration
    client-config       Print the client configuration
    generate-example    Generate an example configuration file
    help                Prints this message or the help of the given subcommand(s)
    list                List clients in this configuration
    remove-client       Remove a client from the configuration
    router-config       Print the router configuration
```

# Quick start

## Generating an example configuration
Generate an example configuration file, run `wireguard-configure generate-example`.

The generated configuration file should look like this:

```
---
router:
  name: "vpn-router"
  private_key: "wPbMYTCgGzfkg3vlt3xoVLhbozRpvVmM8mkm6PFB1Us="
  public_key: "rQNYShmaF+KI+JdvblFSPxmW5f/GAj7F0qBFwMsztVs="
  external_address:
    address: vpn.com
    port: 31337
  internal_address: 10.0.1.1/24
clients:
  - name: "client-a"
    private_key: "aJQEvc6VUDhGjFr5kHqJaSDMHcVaRFniKHxShx3JiV4="
    public_key: "a8LCjRe7oLdxLdHS1CmGqG9L813TAnMnnEzRTBXkHzM="
    internal_address: 10.0.1.2
    dns: 10.0.1.1
    allowed_ips:
      - 0.0.0.0/0
    persistent_keepalive: 25
  - name: "client-b"
    private_key: "mGnpzl6bP/zSJ5x04xNF/AxgHlGTOlPNNCmtRUIyO1U="
    public_key: "rCMWJp3RMXgx/cgWAohhSYJBG3+SQD2hhFcBd0eVwmg="
    internal_address: 10.0.1.3
    dns: ~
    allowed_ips:
      - 10.0.1.0/24
    persistent_keepalive: 25
```

## Adding a new client

We can add another client with the `add-client` subcommand.

```
wireguard-configure-add-client 0.2.1
Add a client to the configuration

USAGE:
    wireguard-configure add-client [OPTIONS] <configuration-path> <client-name> -a <allowed-ips>... -i <internal-address>

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

OPTIONS:
    -a <allowed-ips>...
            A list of subnets to be routed through the VPN for this client (e.g 10.0.0.1/32)

    -d, --dns <dns>                                      The DNS server to use
    -i <internal-address>                                Internal address for the new client
    -p, --persistent-keepalive <persistent-keepalive>    Persistent keepalive for the client
        --pub <public-key>                               Use the given public key, do not use an auto-generated key-pair

ARGS:
    <configuration-path>    wireguard-configure configuration file
    <client-name>           Name of client to add
```

To add a client named `client-c` with address `10.0.1.4` that should route only the remote subnet through the VPN:

    wireguard-configure add-client <config> client-c -a 10.0.1.0/24 -i 10.0.1.4

### How to route all traffic through the VPN

To route all the traffic generated by a client, just specify `allowed_ips` to be `0.0.0.0/0`.

    wireguard-configure add-client <config> client-c -a 0.0.0.0/0 -i 10.0.1.4


## Printing the configurations

### Router configuration

Invoking 
      
      wireguard-configure router-config <config>
    
prints out the router configuration.

```
# vpn-router
[Interface]
Address = 10.0.1.1/24
PrivateKey = wPbMYTCgGzfkg3vlt3xoVLhbozRpvVmM8mkm6PFB1Us=
ListenPort = 31337

# client-a
[Peer]
PublicKey = a8LCjRe7oLdxLdHS1CmGqG9L813TAnMnnEzRTBXkHzM=
PersistentKeepalive = 25
AllowedIPs = 10.0.1.2/32

# client-b
[Peer]
PublicKey = rCMWJp3RMXgx/cgWAohhSYJBG3+SQD2hhFcBd0eVwmg=
PersistentKeepalive = 25
AllowedIPs = 10.0.1.3/32
```

### Client configuration

To print a specific client's configuration, invoke

    wireguard-configure client-config <config> <client>

```
# client-a
[Interface]
PrivateKey = aJQEvc6VUDhGjFr5kHqJaSDMHcVaRFniKHxShx3JiV4=
Address = 10.0.1.2
DNS = 10.0.1.1

# vpn-router
[Peer]
PublicKey = a8LCjRe7oLdxLdHS1CmGqG9L813TAnMnnEzRTBXkHzM=
Endpoint = vpn.com:31337
AllowedIPs = 0.0.0.0/0
```
